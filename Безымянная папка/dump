@app.route('/addpost/', methods=['POST', 'GET'])
@login_required
def add_post():
    try:
        form = ArticleForm(request.form)
        dt = datetime.date.today()
        post_date = dt.strftime("%d/%m/%y")
        if request.method == "POST" and form.validate():
            if form.title.data and form.post_text.data:
                c, conn = connection()
                sql = c.execute("insert into posts (post_title, post_text, post_date, post_username) values(%s, %s, %s, %s)",
                    (form.title.data, form.post_text.data, post_date, session.get('username')))
                conn.commit()
                flash('New article is created.')
                c.close()
                conn.close()
                gc.collect()

                session['logged_in'] = True

                return redirect(url_for('news'))
            else:
                flash('Title and text should not be empty.')
            return render_template('addpost.html', username=session['username'], form=form)
        return render_template("addpost.html", form=form)

    except Exception as e:
        return str(e)
        flash('You were not logged in. Please sign in first.')
